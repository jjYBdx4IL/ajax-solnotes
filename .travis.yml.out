dist: focal
language: node_js
node_js:
  - "14"
jobs:
before_install:
    - "npm install -g npm@^2"
    - install -d /home/travis/dlcache/
    - if ! test -e /home/travis/dlcache/solr.tgz; then wget -O /home/travis/dlcache/solr.tgz https://archive.apache.org/dist/lucene/solr/7.7.3/solr-7.7.3.tgz; fi
    - ls -l /home/travis/dlcache/
    - du -sm /home/travis/dlcache/
install:
    - java -version
    - install -d solr
    - tar xzf  /home/travis/dlcache/solr.tgz --strip-components=1 -C solr
    - cd solr/bin && ./solr start && ./solr create_core -c notes || ls -l
    - npm install
    - curl "http://localhost:8983/solr/notes/select?indent=on&q=text:*&rows=10&start=3"
    - curl "http://127.0.0.1:8983/solr/notes/select?indent=on&q=text:*&rows=10&start=3"
script:
    - npm run ci
cache:
  directories:
    - /home/travis/dlcache/
